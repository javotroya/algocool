'use strict';let App={Template:{},Model:{},Collection:{},View:{},Router:{},Render:{},Clear:{}};App.Render=(a,b)=>{b=b||a.element||"#main";let c=$(b+" > [class]");_.each(c,a=>{let b=$("."+a.className).data("view");_.isUndefined(b)||App.Clear(b)}),$(b).html(a.el),a.render()},App.Clear=function(a){_.isUndefined(a)||(a.onClose=a.onClose||function(){},a.onClose(),a.rivets&&a.rivets.unbind(),a.unbind(),a.model&&a.model.unbind("change",a.render,a),a.collection&&a.collection.unbind("change",a.render,a),a.remove(),delete a.$el,delete a.el)},App.ShowLoader=function(){$("#loader").show(),$("#main").hide()},App.HideLoader=function(){$("#loader").hide(),$("#main").show()},App.Render404=function(){$("#main").html("<h1 class=\"text-center my-3\">404 Not found</h1>").append("<p class=\"text-center mb-4\">Sorry, we tried so hard and got so far, but in the end, it didn't even matter...</p>").append(`<p class="text-center">
		<a class="btn btn-primary" title="...until you are complete again"
		href="${sessionStorage.getItem("goBackURL")}">From where you came, you should remain...</a>
	</p>`)},App.View=Backbone.View.extend({initialize:function(a){let b=this;_.bindAll(this,"render"),this.options=a||{},_.isUndefined(this.options.model)||(this.model=this.options.model),this.postRender=this.postRender||function(){},this.preRender=this.preRender||function(){},this.render=_.wrap(this.render,function(a){return b.preRender(),a(),this.wait||b.postRender(),b})},wait:this.wait||!0,preRender:function(){},render:function(){let a=this,b=$(this.template).html();return this.wait?this.listenTo(this[this.listen],"sync",function(c){_.isFunction(a.waitFunction)?a.waitFunction(c):(a.data=a[this.listen].toJSON(),!_.isUndefined(a.data[0])&&(a.data=a.data[0])),a.$el.html(Mustache.render(b,a.data)),$(a.element).html(a.el),a.postRender()}):(a.$el.html(Mustache.render(b,a.data)),$(this.element).html(this.el),App.HideLoader()),this},listen:"collection",postRender:function(){this.delegateEvents(this.events),$(this.el).data("view",this),App.HideLoader()}}),App.Model.Movie=Backbone.Model.extend({url:function(){return`https://yts.lt/api/v2/movie_details.json?movie_id=${this.id}`}}),App.Collection.Movies=Backbone.Collection.extend({model:App.Model.Movie,url:"https://yts.lt/api/v2/list_movies.json"});"use strict",App.View.HomePage=App.View.extend({initialize:function(a){App.View.prototype.initialize.apply(this,[a]);const b=this;this.collection.fetch({data:this.options.fetchData,success:function(a,c){if(b.renderPagination(c),$("#pagination").slideDown(),b.collection.toJSON()[0].data.hasOwnProperty("movies")){let a,c=Math.floor(Math.random()*b.collection.toJSON()[0].data.movies.length);_.forEach(b.collection.toJSON()[0].data.movies,function(b,d){d===c&&(a=b.large_cover_image)}),$("#search-form-container").css({background:`url(${a})`,"background-size":"cover","background-repeat":"no-repeat","background-position":"center center"})}else App.Render404()}})},waitFunction:function(a){let b=a.toJSON()[0];b.movie_word=1===b.movie_count?"Movie":"Movies",this.data=b},className:"HomePage",element:"#main",template:"#AppViewHomePage",events:{"click .show-movie-details":function(a){a.preventDefault(),Backbone.history.navigate(`movie/${this.$el.find(a.currentTarget).data("id")}`,{trigger:!0})}},renderPagination:function(a){let b=this.options.fetchData,c=Math.floor(a.data.movie_count/20),d=a.data.page_number,e="<div class=\"col-md-8\"><nav aria-label=\"...\" id=\"pagination\"><ul class=\"pagination justify-content-center\">";if(10<c){b.page=1,e+=`<li class="page-item"><a class="page-link" href="#?${$.param(b)}">first</a></li>`;let a=10<d?d-5:1;for(let f=a;f<=a+10;f++)f<c&&(b.page=f,e+=[`<li class="page-item${d===f?" active":""}">`,`<a class="page-link" href="#?${$.param(b)}">`,f,`</a>`,`</li>`].join("\n"));b.page=c,e+=`<li class="page-item"><a class="page-link" href="#?${$.param(b)}">last</a></li>`,e+=`</nav></div>`}e+="</ul>",$("#pagination").html(e)},preRender:function(){const a=$(".SearchForm");_.forEach(this.options.fetchData,function(b,c){a.find(`[name="${c}"]`).val(b)})},postRender:function(){App.View.prototype.postRender.apply(this),sessionStorage.setItem("goBackURL",window.location.hash)}}),App.Router.HomePage=Backbone.Router.extend({routes:{"?*":function(a){let b=a||{};0<_.size(a)&&(b=$.deparam(a)),b.with_rt_ratings=!0;let c=new App.Collection.Movies,d=new App.View.HomePage({collection:c,fetchData:b});App.Render(d)}},initialize:function(){Backbone.Router.prototype.initialize.call(this)}});let HomePage=new App.Router.HomePage;"use strict",App.View.Movie=App.View.extend({initialize:function(a){App.View.prototype.initialize.apply(this,[a])},className:"Movie",element:"#main",template:"#AppViewMovie",waitFunction:function(a){this.data=a.toJSON().data.movie,this.data.id&&(this.data.goBackURL=sessionStorage.getItem("goBackURL"),this.generateMagnet(),this.generateYouMayLike(),$("#search-form-container").css({background:`url(${this.data.background_image_original})`,"background-size":"cover","background-repeat":"no-repeat","background-position":"center center"}),$("#pagination").slideUp())},listen:"model",generateMagnet:function(){const a=this;let b=[];_.forEach(this.data.torrents,function(c){c.magnet=`magnet:?xt=urn:btih:${c.hash}&dn=${encodeURI(a.data.title)}&${"tr="+"udp://open.demonii.com:1337/announce&tr=udp://tracker.openbittorrent.com:80&tr=udp://tracker.coppersurfer.tk:6969&tr=udp://glotorrents.pw:6969/announce&tr=udp://tracker.opentrackr.org:1337/announce&tr=udp://torrent.gresille.org:80/announce&tr=udp://p4p.arenabg.com:1337&tr=udp://tracker.leechers-paradise.org:6969"}`,b.push(c)}),this.data.torrents=b},generateYouMayLike:function(){const a=this;let b,c=Math.floor(11*Math.random()),d=Math.floor(Math.random()*this.data.genres.length);_.forEach(this.data.genres,function(a,c){c===d&&(b=a)});let e=new App.Collection.Movies;e.fetch({data:{genre:b,limit:4,page:0<c?c:1},success:function(b){_.forEach(b.toJSON()[0].data.movies,function(b){a.$el.find("#movie-recommendation").append(`<div class="col">
						<a href="#movie/${b.id}">
							<img src="${b.large_cover_image}" class="img-fluid">
							<div>${b.title}</div>
						</a>
					</div>`)})}})},postRender:function(){App.View.prototype.postRender.apply(this),0===this.data.id&&App.Render404()}}),App.Router.Movies=Backbone.Router.extend({routes:{"movie/:id":function(a){let b=new App.Model.Movie;b.set("id",a);let c=new App.View.Movie({model:b});App.Render(c),b.fetch()}},initialize:function(){Backbone.Router.prototype.initialize.call(this)}});let Movie=new App.Router.Movies;"use strict",App.View.SearchForm=App.View.extend({initialize:function(a){App.View.prototype.initialize.apply(this,[a])},className:"SearchForm",element:"#search-form-container",template:"#AppViewSearchForm",wait:!1,events:{"submit .search-form":function(a){let b=this.$el.find(a.currentTarget),c=$(".HomePage").data("view"),d=b.serialize();Backbone.history.navigate(`?${d}`,{trigger:!0})},"change select":function(){this.$el.find(".search-form").trigger("submit")}}});